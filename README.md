RPC example from Microsoft with some modifications